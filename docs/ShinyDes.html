<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 SUA-FBS Validation Shiny application | Migration of Fishery SUA and FBS compilation into the SWS</title>
  <meta name="description" content="This online book describes the migration of the statistical processes performed by the FAO Fisheries and Aquaculture Department into the Corporate Statistical Working System (SWS) for the compilation of Supply Utilization Accounts (SUAs) and Food Balance Sheets (FBSs) ." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 SUA-FBS Validation Shiny application | Migration of Fishery SUA and FBS compilation into the SWS" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This online book describes the migration of the statistical processes performed by the FAO Fisheries and Aquaculture Department into the Corporate Statistical Working System (SWS) for the compilation of Supply Utilization Accounts (SUAs) and Food Balance Sheets (FBSs) ." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 SUA-FBS Validation Shiny application | Migration of Fishery SUA and FBS compilation into the SWS" />
  
  <meta name="twitter:description" content="This online book describes the migration of the statistical processes performed by the FAO Fisheries and Aquaculture Department into the Corporate Statistical Working System (SWS) for the compilation of Supply Utilization Accounts (SUAs) and Food Balance Sheets (FBSs) ." />
  

<meta name="author" content="Charlotte Taglioni (Statistician, ESSD - Methodological Innovation Team)" />


<meta name="date" content="2020-03-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="PluginCode.html"/>
<link rel="next" href="ShinyCode.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />












<link rel="stylesheet" href="ess.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#introduction"><strong>Introduction</strong></a><ul>
<li><a href="index.html#migration-actors"><strong>Migration actors</strong></a></li>
<li><a href="index.html#new-fias-methodology"><strong>New FIAS methodology</strong></a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>SUAs/FBS for fish and fish products (based on FIAS documentation)</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#working-system-of-fao-fias-for-the-calculation-of-suas-and-fbs"><i class="fa fa-check"></i>Working system of FAO FIAS for the calculation of SUAs and FBS</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#standardization-to-fbs"><i class="fa fa-check"></i>Standardization to FBS</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#fias-processed-production-in-sws-proposed-workflow"><i class="fa fa-check"></i>FIAS processed production in SWS: proposed workflow</a></li>
</ul></li>
<li><a href="index.html#sws-resources"><strong>SWS resources</strong></a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#code-lists"><i class="fa fa-check"></i>Code lists</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#data-tables"><i class="fa fa-check"></i>Data tables</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#datasets"><i class="fa fa-check"></i>Datasets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#definition-and-conversion-of-sua-fbs-elements"><i class="fa fa-check"></i>Definition and conversion of SUA-FBS Elements</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sua-element-conversion"><i class="fa fa-check"></i>SUA element conversion</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#fias-standardized-fbs-element-conversion"><i class="fa fa-check"></i>FIAS standardized FBS element conversion</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#faostat-standardized-fbs-element-conversion"><i class="fa fa-check"></i>Faostat standardized FBS element conversion</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#flag-conversion"><i class="fa fa-check"></i>Flag conversion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="PluginDes.html"><a href="PluginDes.html"><i class="fa fa-check"></i><b>1</b> <strong>SUA-FBS compilation process</strong></a><ul>
<li class="chapter" data-level="1.1" data-path="PluginDes.html"><a href="PluginDes.html#initiate-plugin"><i class="fa fa-check"></i><b>1.1</b> Initiate plugin</a></li>
<li class="chapter" data-level="1.2" data-path="PluginDes.html"><a href="PluginDes.html#pull-data-to-sua"><i class="fa fa-check"></i><b>1.2</b> Pull data to SUA</a></li>
<li class="chapter" data-level="1.3" data-path="PluginDes.html"><a href="PluginDes.html#fill-sua"><i class="fa fa-check"></i><b>1.3</b> Fill SUA</a><ul>
<li class="chapter" data-level="1.3.1" data-path="PluginDes.html"><a href="PluginDes.html#extraction-rate-and-input-calculation"><i class="fa fa-check"></i><b>1.3.1</b> Extraction rate and input calculation</a></li>
<li class="chapter" data-level="1.3.2" data-path="PluginDes.html"><a href="PluginDes.html#food-processing-calculation-and-balancing"><i class="fa fa-check"></i><b>1.3.2</b> Food processing calculation and balancing</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="PluginDes.html"><a href="PluginDes.html#sua-with-nutrients"><i class="fa fa-check"></i><b>1.4</b> SUA with nutrients</a></li>
<li class="chapter" data-level="1.5" data-path="PluginDes.html"><a href="PluginDes.html#standardization"><i class="fa fa-check"></i><b>1.5</b> Standardization</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="PluginCode.html"><a href="PluginCode.html"><i class="fa fa-check"></i><b>2</b> <strong>fi_SUA-FBS plugin R code</strong></a><ul>
<li class="chapter" data-level="2.1" data-path="PluginCode.html"><a href="PluginCode.html#main-file"><i class="fa fa-check"></i><b>2.1</b> Main file</a></li>
<li class="chapter" data-level="2.2" data-path="PluginCode.html"><a href="PluginCode.html#external-functions"><i class="fa fa-check"></i><b>2.2</b> External functions</a><ul>
<li class="chapter" data-level="2.2.1" data-path="PluginCode.html"><a href="PluginCode.html#extraction-rates"><i class="fa fa-check"></i><b>2.2.1</b> Extraction rates</a></li>
<li class="chapter" data-level="2.2.2" data-path="PluginCode.html"><a href="PluginCode.html#input"><i class="fa fa-check"></i><b>2.2.2</b> Input</a></li>
<li class="chapter" data-level="2.2.3" data-path="PluginCode.html"><a href="PluginCode.html#food-processing"><i class="fa fa-check"></i><b>2.2.3</b> Food Processing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ShinyDes.html"><a href="ShinyDes.html"><i class="fa fa-check"></i><b>3</b> <strong>SUA-FBS Validation Shiny application</strong></a><ul>
<li class="chapter" data-level="3.1" data-path="ShinyDes.html"><a href="ShinyDes.html#token-tab"><i class="fa fa-check"></i><b>3.1</b> <strong>Token tab</strong></a></li>
<li class="chapter" data-level="3.2" data-path="ShinyDes.html"><a href="ShinyDes.html#overview-tab"><i class="fa fa-check"></i><b>3.2</b> <strong>Overview tab</strong></a></li>
<li class="chapter" data-level="3.3" data-path="ShinyDes.html"><a href="ShinyDes.html#sua-compare-tab"><i class="fa fa-check"></i><b>3.3</b> <strong>SUA compare tab</strong></a></li>
<li class="chapter" data-level="3.4" data-path="ShinyDes.html"><a href="ShinyDes.html#sua-imbalance-tab"><i class="fa fa-check"></i><b>3.4</b> <strong>SUA imbalance tab</strong></a></li>
<li class="chapter" data-level="3.5" data-path="ShinyDes.html"><a href="ShinyDes.html#fbs-by-ics-tab"><i class="fa fa-check"></i><b>3.5</b> <strong>FBS by ICS tab</strong></a></li>
<li class="chapter" data-level="3.6" data-path="ShinyDes.html"><a href="ShinyDes.html#ics-by-element-tab"><i class="fa fa-check"></i><b>3.6</b> <strong>ICS by element tab</strong></a></li>
<li class="chapter" data-level="3.7" data-path="ShinyDes.html"><a href="ShinyDes.html#global-production-tab"><i class="fa fa-check"></i><b>3.7</b> <strong>Global Production tab</strong></a></li>
<li class="chapter" data-level="3.8" data-path="ShinyDes.html"><a href="ShinyDes.html#commodities-tab"><i class="fa fa-check"></i><b>3.8</b> <strong>Commodities tab</strong></a></li>
<li class="chapter" data-level="3.9" data-path="ShinyDes.html"><a href="ShinyDes.html#link-table-tab"><i class="fa fa-check"></i><b>3.9</b> <strong>Link table tab</strong></a></li>
<li class="chapter" data-level="3.10" data-path="ShinyDes.html"><a href="ShinyDes.html#extraction-rates-tab"><i class="fa fa-check"></i><b>3.10</b> <strong>Extraction rates tab</strong></a></li>
<li class="chapter" data-level="3.11" data-path="ShinyDes.html"><a href="ShinyDes.html#data-validation-tab"><i class="fa fa-check"></i><b>3.11</b> <strong>Data validation tab</strong></a></li>
<li class="chapter" data-level="3.12" data-path="ShinyDes.html"><a href="ShinyDes.html#data-update-tab"><i class="fa fa-check"></i><b>3.12</b> <strong>Data update tab</strong></a></li>
<li class="chapter" data-level="3.13" data-path="ShinyDes.html"><a href="ShinyDes.html#data-saving-tab"><i class="fa fa-check"></i><b>3.13</b> <strong>Data saving tab</strong></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ShinyCode.html"><a href="ShinyCode.html"><i class="fa fa-check"></i><b>4</b> <strong>The Fisheries SUA-FBS Shiny R code</strong></a><ul>
<li class="chapter" data-level="4.1" data-path="ShinyCode.html"><a href="ShinyCode.html#global.r-file"><i class="fa fa-check"></i><b>4.1</b> <strong>‘global.R’ file</strong></a></li>
<li class="chapter" data-level="4.2" data-path="ShinyCode.html"><a href="ShinyCode.html#ui.r-file"><i class="fa fa-check"></i><b>4.2</b> <strong>‘ui.R’ file</strong></a></li>
<li class="chapter" data-level="4.3" data-path="ShinyCode.html"><a href="ShinyCode.html#server.r-file"><i class="fa fa-check"></i><b>4.3</b> <strong>‘server.R’ file</strong></a><ul>
<li class="chapter" data-level="4.3.1" data-path="ShinyCode.html"><a href="ShinyCode.html#overview-tab-1"><i class="fa fa-check"></i><b>4.3.1</b> ‘Overview’ tab</a></li>
<li class="chapter" data-level="4.3.2" data-path="ShinyCode.html"><a href="ShinyCode.html#sua-compare-tab-1"><i class="fa fa-check"></i><b>4.3.2</b> ‘SUA compare’ tab</a></li>
<li class="chapter" data-level="4.3.3" data-path="ShinyCode.html"><a href="ShinyCode.html#sua-imbalance-tab-1"><i class="fa fa-check"></i><b>4.3.3</b> ‘SUA imbalance’ tab</a></li>
<li class="chapter" data-level="4.3.4" data-path="ShinyCode.html"><a href="ShinyCode.html#fbs-by-ics-tab-1"><i class="fa fa-check"></i><b>4.3.4</b> ‘FBS by ICS’ tab</a></li>
<li class="chapter" data-level="4.3.5" data-path="ShinyCode.html"><a href="ShinyCode.html#ics-by-element-tab-1"><i class="fa fa-check"></i><b>4.3.5</b> ‘ICS by Element’ tab</a></li>
<li class="chapter" data-level="4.3.6" data-path="ShinyCode.html"><a href="ShinyCode.html#global-production-tab-1"><i class="fa fa-check"></i><b>4.3.6</b> ‘Global production’ tab</a></li>
<li class="chapter" data-level="4.3.7" data-path="ShinyCode.html"><a href="ShinyCode.html#commodities-tab-1"><i class="fa fa-check"></i><b>4.3.7</b> ‘Commodities’ tab</a></li>
<li class="chapter" data-level="4.3.8" data-path="ShinyCode.html"><a href="ShinyCode.html#link-table-tab-1"><i class="fa fa-check"></i><b>4.3.8</b> ‘Link table’ tab</a></li>
<li class="chapter" data-level="4.3.9" data-path="ShinyCode.html"><a href="ShinyCode.html#extraction-rates-tab-1"><i class="fa fa-check"></i><b>4.3.9</b> ‘Extraction rates’ tab</a></li>
<li class="chapter" data-level="4.3.10" data-path="ShinyCode.html"><a href="ShinyCode.html#data-validation-tab-1"><i class="fa fa-check"></i><b>4.3.10</b> ‘Data validation’ tab</a></li>
<li class="chapter" data-level="4.3.11" data-path="ShinyCode.html"><a href="ShinyCode.html#data-update-tab-1"><i class="fa fa-check"></i><b>4.3.11</b> ‘Data update’ tab</a></li>
<li class="chapter" data-level="4.3.12" data-path="ShinyCode.html"><a href="ShinyCode.html#data-saving-tab-1"><i class="fa fa-check"></i><b>4.3.12</b> ‘Data saving’ tab</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="ShinyCode.html"><a href="ShinyCode.html#external-functions-1"><i class="fa fa-check"></i><b>4.4</b> External functions</a><ul>
<li class="chapter" data-level="4.4.1" data-path="ShinyCode.html"><a href="ShinyCode.html#gprecalc"><i class="fa fa-check"></i><b>4.4.1</b> GPrecalc</a></li>
<li class="chapter" data-level="4.4.2" data-path="ShinyCode.html"><a href="ShinyCode.html#cdbrecalc"><i class="fa fa-check"></i><b>4.4.2</b> CDBrecalc</a></li>
<li class="chapter" data-level="4.4.3" data-path="ShinyCode.html"><a href="ShinyCode.html#suaunbalcalc"><i class="fa fa-check"></i><b>4.4.3</b> SUAunbalCalc</a></li>
<li class="chapter" data-level="4.4.4" data-path="ShinyCode.html"><a href="ShinyCode.html#suabalcalc"><i class="fa fa-check"></i><b>4.4.4</b> SUAbalCalc</a></li>
<li class="chapter" data-level="4.4.5" data-path="ShinyCode.html"><a href="ShinyCode.html#suanutrcalc"><i class="fa fa-check"></i><b>4.4.5</b> SUAnutrCalc</a></li>
<li class="chapter" data-level="4.4.6" data-path="ShinyCode.html"><a href="ShinyCode.html#fbscalc"><i class="fa fa-check"></i><b>4.4.6</b> FBScalc</a></li>
<li class="chapter" data-level="4.4.7" data-path="ShinyCode.html"><a href="ShinyCode.html#reloaddata"><i class="fa fa-check"></i><b>4.4.7</b> reloadData</a></li>
<li class="chapter" data-level="4.4.8" data-path="ShinyCode.html"><a href="ShinyCode.html#reloaddatatoken"><i class="fa fa-check"></i><b>4.4.8</b> reloadDataToken</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Migration of Fishery SUA and FBS compilation into the SWS</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ShinyDes" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> <strong>SUA-FBS Validation Shiny application</strong></h1>
<p>The SUA-FBS shiny application aims to complete the workflow started with the plugin described in section (PluginDes). The shiny app is both an imputation and validation tool for the SUA and FBS compiled by the plugin. Instead of directly accessing the SWS the user has in the shiny app all the supporting information to review plugin results. The shiny app requirements have been initially stated in the document ‘Required for FBS’ available in the share Point at url <a href="https://unfao.sharepoint.com/sites/tssws/SitePages/Home.aspx?RootFolder=%2Fsites%2Ftssws%2FShared%20Documents%2F03%2E%20Statistical%20Documentation%2F02%2E%20Statistical%20Processes%2F09%2E%20FIAS%2FFIAS%20Incorporate%20Fisheries%20into%20FBS%2FFIAS%20Team%20Documentation&amp;FolderCTID=0x012000D903F3EDDBA1B04FB8975A2D03E2388F&amp;View=%7B1025F27D%2DBD2A%2D408B%2D9598%2DD7A041C0B505%7D">https://unfao.sharepoint.com/sites/tssws/SitePages/Home.aspx?RootFolder=%2Fsites%2Ftssws%2FShared%20Documents%2F03%2E%20Statistical%20Documentation%2F02%2E%20Statistical%20Processes%2F09%2E%20FIAS%2FFIAS%20Incorporate%20Fisheries%20into%20FBS%2FFIAS%20Team%20Documentation&amp;FolderCTID=0x012000D903F3EDDBA1B04FB8975A2D03E2388F&amp;View=%7B1025F27D%2DBD2A%2D408B%2D9598%2DD7A041C0B505%7D</a>. Requirements and additional features have been agreed with FIAS unit during the development process.</p>
<p>The shiny app reads the data from the sessions the fi_SUA-FBS plugin has compiled and saves validated data in the corresponding validated datasets.</p>
<p>The application has a top-bottom approach. It starts from the FBS results and allows the user to check how results have been calculated by going more and more into details in the previous datasets. Starting from the FBS results the user can check SUAs throughout and proceed until Global Production and Commodity datasets from which all the other figures derive.</p>
<p>The R Shiny application is available at <a href="http://hqlprsws1.hq.un.fao.org:3838/shinyFisheriesSUAFBS/" class="uri">http://hqlprsws1.hq.un.fao.org:3838/shinyFisheriesSUAFBS/</a> and the very first panel is shown in figure <a href="ShinyDes.html#fig:shiny0">3.1</a>.</p>
<div class="figure"><span id="fig:shiny0"></span>
<img src="img/shiny0.PNG" alt="First tab appearing when opening the shiny app." width="100%" />
<p class="caption">
Figure 3.1: First tab appearing when opening the shiny app.
</p>
</div>
<p>Note: <strong>ALL</strong> the tables displayed in the shiny app can be <strong>downloaded</strong> in <strong>CSV</strong>, <strong>Excel</strong> and <strong>PDF</strong> formats using the buttons showing the formats.</p>
<div id="token-tab" class="section level2">
<h2><span class="header-section-number">3.1</span> <strong>Token tab</strong></h2>
<p>The first tab, the ‘Token’ tab, allow the user to connect to the sessions compiled with the plugin. Each session created into the SWS has an identifier called <em>token</em> that allows the software R to connect and read data from the system. Since data computed by the plugin are not saved in the dataset but only in the session the user has to retrieve the session token to connect the shiny to the SWS. The needed tokens are those of the SUA unbalanced, the SUA balanced, the FIAS standardized FBS and the Faostat standardized FBS. In order to get the tokens the user must enter into the SWS select the ‘Run plugin’ button, select the ‘get_Token’ plugin and press the ‘Get debug token’ button. A window will open and the user can now copy and paste the token in the corresponding boxes in shiny app (figure <a href="ShinyDes.html#fig:shiny1">3.2</a>) and save it pressing the ‘Update token’ button. The steps to obtain the token are described in figure @ref(fig:get_Token).</p>
<div class="figure">
<img src="img/get_Token.png" alt="Example for the _get token_ plugin." width="100%" />
<p class="caption">
(#fig:get_Token)Example for the <em>get token</em> plugin.
</p>
</div>
<p>This operation has to be done only when the plugin has just run and has provided new results, the shiny app stores the tokens into a SWS data table (‘fi_sua_fbs_token’) along with the date of the token update.</p>
<p>Even if the Faostat FBS is not used directly in the shiny it is updated along with the other dataset at the end of the process. A token is therefore needed for it as well. The ‘Data saving’ tab is similar to this one so a session needs to be created and the tokens saved for the correspondent validated datasets. Tokens of the validated datasets will be inserted into the ‘Data saving’ tab.</p>
<p>Note: the session with the plugin results cannot be deleted otherwise all the figures will be lost.</p>
<div class="figure"><span id="fig:shiny1"></span>
<img src="img/shiny1.PNG" alt="Overview of the _Token_ tab." width="100%" />
<p class="caption">
Figure 3.2: Overview of the <em>Token</em> tab.
</p>
</div>
<p>After the user made sure the shiny app connects to the required sessions, the country, time period and FBS elements to visualize in the next tab can be selected (figure <a href="ShinyDes.html#fig:shiny1">3.2</a>). The shiny app is conceived to work country by country as with the previous methodology.</p>
</div>
<div id="overview-tab" class="section level2">
<h2><span class="header-section-number">3.2</span> <strong>Overview tab</strong></h2>
<p>Figure <a href="ShinyDes.html#fig:shinyOverview">3.3</a> presents the overview panel with the example of FBS results for Chile in the time period 2010-2017.</p>
<div class="figure"><span id="fig:shinyOverview"></span>
<img src="img/shinyOverview.png" alt="Overview of the _Overview_ tab." width="100%" />
<p class="caption">
Figure 3.3: Overview of the <em>Overview</em> tab.
</p>
</div>
<p>The tab has two parts: the graph part and the table part. In the graph part shows the time series for the chosen element (food in the example) of each major group plus the grand total. The graphs show the plugin results in light blue (Live, i.e. values saved in the FIAS FBS session) and the previously validated results in light red (Frozen, i.e. results saved in the FIAS FBS validated dataset). In this way the user can see what has been validated in the past and compare with the new results. The table underneath shows the figures corresponding to the time series in the graphs. The user can sort and filter data in the table as wished.</p>
</div>
<div id="sua-compare-tab" class="section level2">
<h2><span class="header-section-number">3.3</span> <strong>SUA compare tab</strong></h2>
<p>In the second tab the user has the comparison between ‘live’ and ‘frozen’ data for SUAs(figure <a href="ShinyDes.html#fig:shinySUAcomp">3.4</a>). The user can select from the left-side menu what FBS group(s) and elements to visualize. For the elements an ‘Element group’ button has been created t allow the user to rapidly select several elements at the same time. The groups correspond to the following element choices: - Single: is the default choice, no element automatically selected, the user has to choose manually. - All: all elements are automatically selected. -Primary: only SUA unbalanced elements are selected, i.e. the production, import, export and also the input as it can reveal further details with respect to production only. -SUA: all the SUA elements, nutrition factors excluded. - Nutrients: only nutrient related elements are selected (Kcal/year, Kcal/caput/day, Proteins/year, Proteins/caput/day, Fats/year, Fats/caput/day).</p>
<p>From the table the user can sort and filter data and see the difference between the frozen and live data looking at the last table column ‘Diff’.</p>
<div class="figure"><span id="fig:shinySUAcomp"></span>
<img src="img/shinySUAcomp.png" alt="Overview of the _SUA compare_ tab." width="100%" />
<p class="caption">
Figure 3.4: Overview of the <em>SUA compare</em> tab.
</p>
</div>
</div>
<div id="sua-imbalance-tab" class="section level2">
<h2><span class="header-section-number">3.4</span> <strong>SUA imbalance tab</strong></h2>
<p>The SUA imbalance tab (figure <a href="ShinyDes.html#fig:shinySUAimb">3.5</a>) only reports SECONDARY imbalances. The reason is that the plugin does not fix primary imbalances, they are temporarily balanced with the Residual element (5166). They can be checked both in the ‘SUA compare’ tab and in the ‘Data validation’ tab, but the user has to manually fix with <em>ad-hoc</em> measures primary imbalances. Secondary imbalances are fixed by the plugin by increasing production figures until the imbalance is covered. FIAS unit required secondary products do not include meals that need <em>ad-hoc</em> solutions. They are therefore treated as primary products.</p>
<p>The tab has three part, the first up left parts has graphs of the imbalances by products. The user can see the series of imbalances and check the figures in the table in the up right part.</p>
<p>The table in the bottom part contains the production elements for all the SUAs (not only for secondary elements) and both original production and production after the increase are displayed. By giving this information the user controls and is aware of the increase and can modify the production figure in the ‘Data validation’ tab if needed.</p>
<div class="figure"><span id="fig:shinySUAimb"></span>
<img src="img/shinySUAimb.png" alt="Overview of the _SUA imbalance_ tab." width="100%" />
<p class="caption">
Figure 3.5: Overview of the <em>SUA imbalance</em> tab.
</p>
</div>
</div>
<div id="fbs-by-ics-tab" class="section level2">
<h2><span class="header-section-number">3.5</span> <strong>FBS by ICS tab</strong></h2>
<p>In order to have a more comprehensive vision of the composition of each FBS group, the ‘FBS by ICS’ tab gives the time series of each FBS element for all products composing the major group selected.</p>
<p>Because the shiny app takes values from the SUAs only values present both in the SUA and in the FBS can be checked. The graphs shows only products having data for the selected element. The table below shows the complete SUA for the selected group, the user can sort and filter the data in the table as usual.</p>
<p>Figure @ref{fig:shinyICS} shows the example of ‘Food (5141)’ for ‘Demersal fish (20)’ major group. From the left-side menu the user can select and deselect ICS products as wished.</p>
<div class="figure"><span id="fig:shinyICS"></span>
<img src="img/shinyICS.PNG" alt="Overview of the _FBS by ICS_ tab." width="100%" />
<p class="caption">
Figure 3.6: Overview of the <em>FBS by ICS</em> tab.
</p>
</div>
</div>
<div id="ics-by-element-tab" class="section level2">
<h2><span class="header-section-number">3.6</span> <strong>ICS by element tab</strong></h2>
<p>This tab allow the user to see, for the selected product, the time series of all SUA elements. From the left-side menu (figure <a href="ShinyDes.html#fig:shinyElements">3.7</a>), the user selects the major group and the product and then, by default, all the elements are shown in the graph along with the data in the table below. The user can select or deselect elements as wished.</p>
<div class="figure"><span id="fig:shinyElements"></span>
<img src="img/shinyElements.png" alt="Overview of the _ICS by element_ tab." width="100%" />
<p class="caption">
Figure 3.7: Overview of the <em>ICS by element</em> tab.
</p>
</div>
</div>
<div id="global-production-tab" class="section level2">
<h2><span class="header-section-number">3.7</span> <strong>Global Production tab</strong></h2>
<p>In order to check data until the very first source, the user can look at the data in the Global production and the Commodity datasets respectively in the ‘Global prod’ and the ‘Commodities’ tabs. ‘Global prod’ tab (figure <a href="ShinyDes.html#fig:shinyGP">3.8</a>) allows the user to select one or more FBS group/s and to see all the species contained into the Global production dataset belonging to the selected group/s.</p>
<p>On the left-side part, in addition to the FBS group button, there is a table containing the deviation previously set for species in the selected country and allows the user to add a new deviation. The table is partially pre-compiled so that the user has to add only the species to deviate and to write from which ICS to what other one. Nevertheless, the user can always change the pre-compiled fields and change the validity period and the ratio. The validity period is set by default from the last year until the ‘LAST’ i.e. forever until a further modification is done. The ratio is 1 by default, but the user can split the quantity and deviate only a part of the production to a different product. In case the user wants to change destination only for one part, e.g. 40% and leave the other 60% to the original product, then only one row can be inserted, the 60% unchanged percent will automatically stay to the original ICS. If all the quantity has to be deviated to more than one product then all these alternative products must be specified. After the table has been modified it has to be saved into the SWS by clicking the ‘Save’ button in the upper-left part of the screen. This information is saved in a data table, meaning there is no further saving required. Differently from datasets, data tables are modified and saved directly from the shiny app with no other action to be done directly in the system.</p>
<div class="figure"><span id="fig:shinyGP"></span>
<img src="img/shinyGP.PNG" alt="Overview of the _Global production_ tab." width="100%" />
<p class="caption">
Figure 3.8: Overview of the <em>Global production</em> tab.
</p>
</div>
</div>
<div id="commodities-tab" class="section level2">
<h2><span class="header-section-number">3.8</span> <strong>Commodities tab</strong></h2>
<p>The ‘Commodities’ tab is similar to the previous ‘Global prod’ tab but it also includes the possibility to select the specific ICS product (all the Global Production data are primary products so there was no need to add the ICS button). Also in this tab, there is the table for deviation of single commodities from one product to another and the user can complete and modify it the same way as described for the previous tab. The additional feature is the need to specify the flow to deviate as in the Commodity dataset there are also trade data, in addition to production. The user has to write the code of the element to deviate as displayed in the left-side menu and in the table (figure <a href="ShinyDes.html#fig:shinyCDB">3.9</a>).</p>
<p>After the table has been modified it has to be saved into the SWS by clicking the ‘Save’ button in the upper-left part of the screen. This information is saved in a data table, meaning there is no further saving required. Differently from datasets, data tables are modified and saved directly from the shiny app with no other action to be done directly in the system.</p>
<div class="figure"><span id="fig:shinyCDB"></span>
<img src="img/shinyCDB.PNG" alt="Overview of the _Commodities_ tab." width="100%" />
<p class="caption">
Figure 3.9: Overview of the <em>Commodities</em> tab.
</p>
</div>
</div>
<div id="link-table-tab" class="section level2">
<h2><span class="header-section-number">3.9</span> <strong>Link table tab</strong></h2>
<p>Sometimes flows have to be deviated as a whole from one ICS product to another. For this reason the ‘Link table’ tab (figure <a href="ShinyDes.html#fig:shinyLink">3.10</a>) contains the table for the selected country and shows all the deviations already applied. The user can modify the table directly in the shiny app taking care to consistently insert the new information: write the flow with the same letters are other deviations and in capital letters: ‘PRD’ for production, ‘EXP’ for export, ‘IMP’ for import, ‘TRD’ for trade and ‘ALL’ for all flows; write the percentage in decimals (1 for 100%, 0.6 for 60%…).</p>
<div class="figure"><span id="fig:shinyLink"></span>
<img src="img/shinyLink.png" alt="Overview of the _Link table_ tab." width="100%" />
<p class="caption">
Figure 3.10: Overview of the <em>Link table</em> tab.
</p>
</div>
</div>
<div id="extraction-rates-tab" class="section level2">
<h2><span class="header-section-number">3.10</span> <strong>Extraction rates tab</strong></h2>
<p>The ‘Extraction rates’ tab has been requested to perform block or single extraction rate updates and not to make year and product detailed operations. It has been conceived as a way to do updates that applies to more than one cell avoiding changing cells one by one. In this tab, figure <a href="ShinyDes.html#fig:shinyEr">3.11</a>, the user can change the figures for the extraction values and see the current values for the time series selected. Depending on the choice the user makes selecting the ‘Update type’ from the left-side menu, the modification can apply to single years or to the selected time series. Once the modification is validated (‘Update’ button in the left-side menu), the new figure appear in the ‘Data validation’ tab and will be applied during the new recalculations.</p>
<div class="figure"><span id="fig:shinyEr"></span>
<img src="img/shinyEr.PNG" alt="Overview of the _Extraction rates_ tab." width="100%" />
<p class="caption">
Figure 3.11: Overview of the <em>Extraction rates</em> tab.
</p>
</div>
</div>
<div id="data-validation-tab" class="section level2">
<h2><span class="header-section-number">3.11</span> <strong>Data validation tab</strong></h2>
<p>The data validation tab is the most interactive and the only true working tab of the shiny. From the left-side menu the user has to select the major groups, the products and the elements to visualize SUA for. The modification can be done in two ways:</p>
<ol style="list-style-type: decimal">
<li>Directly on the tab</li>
<li>Uploading a <strong>CSV</strong> file (<strong>CAUTION!</strong>)</li>
</ol>
<p>In the case of file uploading the advice is to first download the whole SUA in <strong>CSV format</strong>, to modify figures in this file and to upload this same file which has already the right template to be processed by the shiny. Depending on the user’s choice the ‘Update to consider’ button must be selected accordingly.</p>
<p>The button to download and upload the file are in the upper part of the tab, figure <a href="ShinyDes.html#fig:shiny7up">3.14</a>. The user is allowed to do different kind of modification and, depending on them, to perform different kind of recalculations. First of all many changes concern extraction rates or the insertion of input values coming from publications. For this reason in the left-side menu (figure <a href="ShinyDes.html#fig:shiny7side">3.13</a>) the user has to choose if the recalculation functions have to prioritize the extraction rate or the input. If no official input is available then the better solution is to choose to use the extraction rate. If official input is available from publications, then the user can choose to prioritize the input so that the functions recalculate the extraction rates and flag the input as an official figure from publication. Note that the user has to choose one of the two in order to proceed to the reprocessing. Otherwise the shiny will return a message reminding to choose one option (by default the invalid ‘Null’ option is selected).</p>
<p>The user can choose to change some quantities and leave the others be recalculated freely from the functions or to assign all the quantities and define the exact form of the SUA balanced. Depending on the modification the user can also choose what kind or reprocessing the shiny has to perform:</p>
<ul>
<li><p>If modifications involve Global production, Commodity or ICS deviations then a ‘Complete’ recalculation is the right choice and, in general, is the one that avoid any unwanted inconsistency.</p></li>
<li><p>If the user only wants to test the effect of a minor change only to see the effect on the SUA, then the ‘Only SUA balance’ choice is the quickest option.</p></li>
<li><p>If the user wants to recalculate from the SUA balanced until the FBS then ‘Since SUA balanced’ is the right choice.</p></li>
<li><p>If the user do not want the shiny to do any change to the SUA but only perform the aggregation and the nutrient related calculations, the ‘Only Nutrients &amp; FBS’ button has to be selected.</p></li>
</ul>
<p>After having selected all the options the button ‘Save and Recalc’ initiate recalculations and a window will notice when calculations are complete. After the end of the reprocessing calculations the new SUA appears in the tab and the effect on the FBS can be checked in the following tab.</p>
<p>The user can recalculate as many times as wanted bearing in mind each recalculation is saved and new calculations use the new calculated values.</p>
<div class="figure"><span id="fig:shiny7"></span>
<img src="img/shiny7.PNG" alt="Overview of the _Data validation_ tab." width="100%" />
<p class="caption">
Figure 3.12: Overview of the <em>Data validation</em> tab.
</p>
</div>
<div class="figure"><span id="fig:shiny7side"></span>
<img src="img/shiny7side.png" alt="Side manu of the _Data validation_ tab." width="60%" />
<p class="caption">
Figure 3.13: Side manu of the <em>Data validation</em> tab.
</p>
</div>
<div class="figure"><span id="fig:shiny7up"></span>
<img src="img/shiny7up.PNG" alt="Upper part of the _Data validation_ tab." width="100%" />
<p class="caption">
Figure 3.14: Upper part of the <em>Data validation</em> tab.
</p>
</div>
</div>
<div id="data-update-tab" class="section level2">
<h2><span class="header-section-number">3.12</span> <strong>Data update tab</strong></h2>
<p>The ‘Data update’ tab is a copy of the ‘Overview’ tab but shows the FBS resulting from the recalculations of the previous tab. The user can compare the results (example in figure <a href="ShinyDes.html#fig:shiny8">3.15</a>) with the ‘Overview’ tab that keeps on storing the original values and decide if to validate and save back this new SUA and FBS back into the SWS. If the user is satisfied of the results,or just do not want to lose the work so far the data have to be saved int the following tab and transfer all the figures for the country to the SWS.</p>
<div class="figure"><span id="fig:shiny8"></span>
<img src="img/shiny8.PNG" alt="Overview of the _Data update_ tab." width="100%" />
<p class="caption">
Figure 3.15: Overview of the <em>Data update</em> tab.
</p>
</div>
</div>
<div id="data-saving-tab" class="section level2">
<h2><span class="header-section-number">3.13</span> <strong>Data saving tab</strong></h2>
<p>This last tab is similar to the first tab ( <em>Token</em> tab) but the required tokens refer to the <em>validated</em> datasets corresponding to the modified datasets (figure @ref{fig:shinysave}). As with the other tokens the user needs to save them only once and they sessions will be saved. Once the user is satisfied with the modifications and does not need the previous data anymore the new values can be saved through the button ‘Update SWS’. The shiny will update BOTH the working sessions and the validated sessions so when restarting the work the user can start form where he/she was. In the unlikely (impossible?) case a non-reversible error is committed somehow and initial data cannot be retrieved the user can always re-run the ‘fi_SUA-FBS’ plugin for the country he/she lost data for.</p>
<div class="figure"><span id="fig:shinysave"></span>
<img src="img/shinysave.png" alt="Overview of the _Data update_ tab." width="100%" />
<p class="caption">
Figure 3.16: Overview of the <em>Data update</em> tab.
</p>
</div>
<p>A message after the saving of all the dataset will notify the user the process has run correctly. It is important that after the update the user checks that the values have been saved in the session of the validated datasets and, ONLY when the final result are ready for the country, the data are saved from the session to the dataset.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="PluginCode.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ShinyCode.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
